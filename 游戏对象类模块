玩家飞机类：
# player.py
import pygame
from config import *
from resources import get_chinese_font

class Player(pygame.sprite.Sprite):
    def __init__(self, ship_type=0):
        super().__init__()
        self.ship_type = ship_type
        self._load_appearance()
        
        self.rect = self.image.get_rect()
        self.rect.centerx = WIDTH // 2
        self.rect.bottom = HEIGHT - 10
        self.speed = 8
        self.health = 100
        self.max_health = 100
        self.invulnerable = False
        self.invulnerable_timer = 0

        # 道具效果
        self.has_resistance = False
        self.has_healing = False
        self.has_attack_boost = False
        self.healing_timer = 0

    def _load_appearance(self):
        """根据飞机类型加载外观"""
        try:
            if os.path.exists("playerShip2_red.png"):
                self.image = pygame.image.load("playerShip2_red.png").convert_alpha()
                original_width, original_height = self.image.get_size()
                self.image = pygame.transform.scale(self.image, 
                                                   (original_width // 2, original_height // 2))
            else:
                self.image = pygame.Surface((50, 40), pygame.SRCALPHA)
                colors = [GREEN, BLUE, PURPLE]
                color = colors[self.ship_type % 3]
                pygame.draw.polygon(self.image, color, [(25, 0), (0, 40), (50, 40)])
                pygame.draw.rect(self.image, color, (15, 20, 20, 20))

                font = get_chinese_font(20)
                type_text = font.render(f"{self.ship_type + 1}", True, WHITE)
                text_rect = type_text.get_rect(center=(25, 20))
                self.image.blit(type_text, text_rect)
        except:
            self.image = pygame.Surface((50, 40))
            colors = [GREEN, BLUE, PURPLE]
            self.image.fill(colors[self.ship_type % 3])

    def update(self):
        keys = pygame.key.get_pressed()
        if keys[pygame.K_LEFT] and self.rect.left > 0:
            self.rect.x -= self.speed
        if keys[pygame.K_RIGHT] and self.rect.right < WIDTH:
            self.rect.x += self.speed
        if keys[pygame.K_UP] and self.rect.top > 0:
            self.rect.y -= self.speed
        if keys[pygame.K_DOWN] and self.rect.bottom < HEIGHT:
            self.rect.y += self.speed

        # 处理无敌状态
        if self.invulnerable:
            self.invulnerable_timer -= 1
            if self.invulnerable_timer <= 0:
                self.invulnerable = False
                self.update_appearance()

        # 处理自回血效果
        if self.has_healing:
            self.healing_timer += 1
            if self.healing_timer >= 900:  # 15秒 * 60帧/秒
                self.healing_timer = 0
                self.health = min(self.max_health, self.health + 10)

    def update_appearance(self):
        """根据道具状态更新飞机外观"""
        try:
            if not os.path.exists("playerShip2_red.png"):
                self.image = pygame.Surface((50, 40), pygame.SRCALPHA)
                colors = [GREEN, BLUE, PURPLE]
                color = colors[self.ship_type % 3]

                # 根据道具效果添加不同标记
                if self.has_resistance:
                    pygame.draw.rect(self.image, YELLOW, (0, 0, 10, 10))
                if self.has_healing:
                    pygame.draw.rect(self.image, GREEN, (40, 0, 10, 10))
                if self.has_attack_boost:
                    pygame.draw.rect(self.image, RED, (0, 30, 10, 10))

                pygame.draw.polygon(self.image, color, [(25, 0), (0, 40), (50, 40)])
                pygame.draw.rect(self.image, color, (15, 20, 20, 20))

                font = get_chinese_font(20)
                type_text = font.render(f"{self.ship_type + 1}", True, WHITE)
                text_rect = type_text.get_rect(center=(25, 20))
                self.image.blit(type_text, text_rect)
        except:
            pass

    def shoot(self, all_sprites, bullets, shoot_sound):
        bullet = Bullet(self.rect.centerx, self.rect.top, self.has_attack_boost)
        all_sprites.add(bullet)
        bullets.add(bullet)
        if shoot_sound:
            shoot_sound.play()

    def take_damage(self, amount, damage_type="bullet"):
        """受到伤害"""
        if not self.invulnerable:
            # 应用抗性增强道具效果
            if self.has_resistance:
                if damage_type == "bullet":
                    amount = 1
                elif damage_type == "collision":
                    amount = 10

            self.health -= amount
            if self.health < 0:
                self.health = 0

            # 设置无敌状态（1秒）
            self.invulnerable = True
            self.invulnerable_timer = 60

            # 受伤时闪烁效果
            if not os.path.exists("playerShip2_red.png"):
                self.image.fill(RED)

    def is_invulnerable(self):
        return self.invulnerable

    def add_item(self, item_type):
        """添加道具效果"""
        if item_type == "resistance":
            self.has_resistance = True
        elif item_type == "healing":
            self.has_healing = True
        elif item_type == "attack_boost":
            self.has_attack_boost = True
        self.update_appearance()

# enemy.py
import pygame
import random
import math
from config import *
from resources import get_chinese_font

class Enemy(pygame.sprite.Sprite):
    def __init__(self, health=100):
        super().__init__()
        self._load_appearance()
        
        self.rect = self.image.get_rect()
        self.rect.x = random.randrange(WIDTH - self.rect.width)
        self.rect.y = random.randrange(-100, -40)

        self.health = health
        self.max_health = health
        self.speed = random.uniform(1.0, 3.0)
        self.direction = random.uniform(0, 2 * math.pi)
        self.direction_change_timer = 0
        self.direction_change_interval = random.randint(30, 90)
        self.shoot_delay = random.randrange(3000, 6000)
        self.last_shot = pygame.time.get_ticks()

    def _load_appearance(self):
        """加载敌机外观"""
        try:
            if os.path.exists("enemyBlack5.png"):
                self.image = pygame.image.load("enemyBlack5.png").convert_alpha()
                original_width, original_height = self.image.get_size()
                self.image = pygame.transform.scale(self.image, 
                                                   (original_width // 2, original_height // 2))
            else:
                self.image = pygame.Surface((30, 30), pygame.SRCALPHA)
                pygame.draw.polygon(self.image, RED, [(15, 30), (0, 0), (30, 0)])
                pygame.draw.rect(self.image, RED, (5, 0, 20, 15))
        except:
            self.image = pygame.Surface((30, 30))
            self.image.fill(RED)

    def update(self, game_progress):
        # 随机飞行轨迹
        self.direction_change_timer += 1
        if self.direction_change_timer >= self.direction_change_interval:
            self.direction_change_timer = 0
            self.direction += random.uniform(-0.5, 0.5)
            self.direction %= 2 * math.pi

        # 根据方向移动
        self.rect.x += math.cos(self.direction) * self.speed
        self.rect.y += math.sin(self.direction) * self.speed

        # 边界检查
        if self.rect.left < 0:
            self.rect.left = 0
            self.direction = math.pi - self.direction
        elif self.rect.right > WIDTH:
            self.rect.right = WIDTH
            self.direction = math.pi - self.direction

        if self.rect.top < 0:
            self.rect.top = 0
            self.direction = -self.direction
        elif self.rect.bottom > HEIGHT:
            self.rect.x = random.randrange(WIDTH - self.rect.width)
            self.rect.y = random.randrange(-100, -40)
            self.direction = random.uniform(0, 2 * math.pi)

        # 敌机射击
        now = pygame.time.get_ticks()
        current_shoot_delay = max(500, self.shoot_delay - (game_progress * 2))
        if now - self.last_shot > current_shoot_delay:
            self.last_shot = now
            self.shoot()

    def shoot(self, all_sprites, enemy_bullets):
        enemy_bullet = EnemyBullet(self.rect.centerx, self.rect.bottom)
        all_sprites.add(enemy_bullet)
        enemy_bullets.add(enemy_bullet)

    def take_damage(self, amount, extra_damage=0):
        """敌机受到伤害"""
        self.health -= (amount + extra_damage)
        return self.health <= 0
    # bullets.py
import pygame
from config import *
from resources import load_image

class Bullet(pygame.sprite.Sprite):
    def __init__(self, x, y, has_attack_boost=False):
        super().__init__()
        self.has_attack_boost = has_attack_boost
        self._load_appearance()
        
        self.rect = self.image.get_rect()
        self.rect.centerx = x
        self.rect.bottom = y
        self.speedy = -10

    def _load_appearance(self):
        """加载子弹外观"""
        try:
            if os.path.exists("laserRed15.png"):
                self.image = pygame.image.load("laserRed15.png").convert_alpha()
                original_width, original_height = self.image.get_size()
                self.image = pygame.transform.scale(self.image, 
                                                   (original_width // 2, original_height // 2))

                # 如果有攻击加强，改变子弹颜色
                if self.has_attack_boost:
                    overlay = pygame.Surface(self.image.get_size(), pygame.SRCALPHA)
                    overlay.fill((255, 0, 0, 64))  # 半透明红色
                    self.image.blit(overlay, (0, 0))
            else:
                self.image = pygame.Surface((5, 10), pygame.SRCALPHA)
                color = RED if self.has_attack_boost else WHITE
                pygame.draw.rect(self.image, color, (0, 0, 5, 10))
        except:
            self.image = pygame.Surface((5, 10))
            color = RED if self.has_attack_boost else WHITE
            self.image.fill(color)

    def update(self):
        self.rect.y += self.speedy
        if self.rect.bottom < 0:
            self.kill()

class EnemyBullet(pygame.sprite.Sprite):
    def __init__(self, x, y):
        super().__init__()
        self._load_appearance()
        
        self.rect = self.image.get_rect()
        self.rect.centerx = x
        self.rect.top = y
        self.speedy = 5

    def _load_appearance(self):
        """加载敌机子弹外观"""
        try:
            if os.path.exists("laserGreen10.png"):
                self.image = pygame.image.load("laserGreen10.png").convert_alpha()
                original_width, original_height = self.image.get_size()
                self.image = pygame.transform.scale(self.image, 
                                                   (original_width // 2, original_height // 2))
            else:
                self.image = pygame.Surface((5, 10), pygame.SRCALPHA)
                pygame.draw.rect(self.image, YELLOW, (0, 0, 5, 10))
        except:
            self.image = pygame.Surface((5, 10))
            self.image.fill(YELLOW)

    def update(self):
        self.rect.y += self.speedy
        if self.rect.top > HEIGHT:
            self.kill()

            # bullets.py
import pygame
from config import *
from resources import load_image

class Bullet(pygame.sprite.Sprite):
    def __init__(self, x, y, has_attack_boost=False):
        super().__init__()
        self.has_attack_boost = has_attack_boost
        self._load_appearance()
        
        self.rect = self.image.get_rect()
        self.rect.centerx = x
        self.rect.bottom = y
        self.speedy = -10

    def _load_appearance(self):
        """加载子弹外观"""
        try:
            if os.path.exists("laserRed15.png"):
                self.image = pygame.image.load("laserRed15.png").convert_alpha()
                original_width, original_height = self.image.get_size()
                self.image = pygame.transform.scale(self.image, 
                                                   (original_width // 2, original_height // 2))

                # 如果有攻击加强，改变子弹颜色
                if self.has_attack_boost:
                    overlay = pygame.Surface(self.image.get_size(), pygame.SRCALPHA)
                    overlay.fill((255, 0, 0, 64))  # 半透明红色
                    self.image.blit(overlay, (0, 0))
            else:
                self.image = pygame.Surface((5, 10), pygame.SRCALPHA)
                color = RED if self.has_attack_boost else WHITE
                pygame.draw.rect(self.image, color, (0, 0, 5, 10))
        except:
            self.image = pygame.Surface((5, 10))
            color = RED if self.has_attack_boost else WHITE
            self.image.fill(color)

    def update(self):
        self.rect.y += self.speedy
        if self.rect.bottom < 0:
            self.kill()

class EnemyBullet(pygame.sprite.Sprite):
    def __init__(self, x, y):
        super().__init__()
        self._load_appearance()
        
        self.rect = self.image.get_rect()
        self.rect.centerx = x
        self.rect.top = y
        self.speedy = 5

    def _load_appearance(self):
        """加载敌机子弹外观"""
        try:
            if os.path.exists("laserGreen10.png"):
                self.image = pygame.image.load("laserGreen10.png").convert_alpha()
                original_width, original_height = self.image.get_size()
                self.image = pygame.transform.scale(self.image, 
                                                   (original_width // 2, original_height // 2))
            else:
                self.image = pygame.Surface((5, 10), pygame.SRCALPHA)
                pygame.draw.rect(self.image, YELLOW, (0, 0, 5, 10))
        except:
            self.image = pygame.Surface((5, 10))
            self.image.fill(YELLOW)

    def update(self):
        self.rect.y += self.speedy
        if self.rect.top > HEIGHT:
            self.kill()

            # ui_components.py
import pygame
from config import *

class Button:
    def __init__(self, x, y, width, height, text, font, color=LIGHT_BLUE, hover_color=BLUE):
        self.rect = pygame.Rect(x, y, width, height)
        self.text = text
        self.font = font
        self.color = color
        self.hover_color = hover_color
        self.is_hovered = False

    def draw(self, surface):
        color = self.hover_color if self.is_hovered else self.color
        pygame.draw.rect(surface, color, self.rect, border_radius=10)
        pygame.draw.rect(surface, WHITE, self.rect, 2, border_radius=10)

        text_surface = self.font.render(self.text, True, WHITE)
        text_rect = text_surface.get_rect(center=self.rect.center)
        surface.blit(text_surface, text_rect)

    def check_hover(self, pos):
        self.is_hovered = self.rect.collidepoint(pos)
        return self.is_hovered

    def is_clicked(self, pos, event):
        if event.type == pygame.MOUSEBUTTONDOWN and event.button == 1:
            return self.rect.collidepoint(pos)
        return False

class ShopItem:
    def __init__(self, name, description, price, item_type, item_data=None):
        self.name = name
        self.description = description
        self.price = price
        self.item_type = item_type  # "ship" 或 "item"
        self.item_data = item_data
        self.is_purchased = False

    def draw(self, surface, x, y, width, height, font, small_font):
        """绘制商店商品"""
        bg_color = GREEN if self.is_purchased else LIGHT_BLUE
        pygame.draw.rect(surface, bg_color, (x, y, width, height), border_radius=8)
        pygame.draw.rect(surface, WHITE, (x, y, width, height), 2, border_radius=8)

        # 绘制名称和价格
        name_text = font.render(self.name, True, WHITE)
        price_text = small_font.render(f"价格: {self.price}金币", True, YELLOW)

        surface.blit(name_text, (x + 10, y + 10))
        surface.blit(price_text, (x + 10, y + 40))

        # 绘制描述
        desc_text = small_font.render(self.description, True, WHITE)
        surface.blit(desc_text, (x + 10, y + 60))

        # 绘制已购买标记
        if self.is_purchased:
            purchased_text = font.render("已购买", True, GREEN)
            surface.blit(purchased_text, (x + width - 80, y + 10))
            # ui_components.py
import pygame
from config import *

class Button:
    def __init__(self, x, y, width, height, text, font, color=LIGHT_BLUE, hover_color=BLUE):
        self.rect = pygame.Rect(x, y, width, height)
        self.text = text
        self.font = font
        self.color = color
        self.hover_color = hover_color
        self.is_hovered = False

    def draw(self, surface):
        color = self.hover_color if self.is_hovered else self.color
        pygame.draw.rect(surface, color, self.rect, border_radius=10)
        pygame.draw.rect(surface, WHITE, self.rect, 2, border_radius=10)

        text_surface = self.font.render(self.text, True, WHITE)
        text_rect = text_surface.get_rect(center=self.rect.center)
        surface.blit(text_surface, text_rect)

    def check_hover(self, pos):
        self.is_hovered = self.rect.collidepoint(pos)
        return self.is_hovered

    def is_clicked(self, pos, event):
        if event.type == pygame.MOUSEBUTTONDOWN and event.button == 1:
            return self.rect.collidepoint(pos)
        return False

class ShopItem:
    def __init__(self, name, description, price, item_type, item_data=None):
        self.name = name
        self.description = description
        self.price = price
        self.item_type = item_type  # "ship" 或 "item"
        self.item_data = item_data
        self.is_purchased = False

    def draw(self, surface, x, y, width, height, font, small_font):
        """绘制商店商品"""
        bg_color = GREEN if self.is_purchased else LIGHT_BLUE
        pygame.draw.rect(surface, bg_color, (x, y, width, height), border_radius=8)
        pygame.draw.rect(surface, WHITE, (x, y, width, height), 2, border_radius=8)

        # 绘制名称和价格
        name_text = font.render(self.name, True, WHITE)
        price_text = small_font.render(f"价格: {self.price}金币", True, YELLOW)

        surface.blit(name_text, (x + 10, y + 10))
        surface.blit(price_text, (x + 10, y + 40))

        # 绘制描述
        desc_text = small_font.render(self.description, True, WHITE)
        surface.blit(desc_text, (x + 10, y + 60))

        # 绘制已购买标记//
        if self.is_purchased:
            purchased_text = font.render("已购买", True, GREEN)
            surface.blit(purchased_text, (x + width - 80, y + 10))